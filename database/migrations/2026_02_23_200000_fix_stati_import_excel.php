<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Support\Facades\DB;

return new class extends Migration
{
    /**
     * Fix stati fasi importate da Excel:
     * - stato 2 (Avviato) -> 3 (Terminato)
     * - stato 1 (Pronto) -> 2 (Avviato)
     * ORDINE IMPORTANTE: prima 2->3, poi 1->2
     * Filtra solo le commesse presenti nell'Excel di import.
     */
    public function up(): void
    {
        $commesse = [
            '0058512-24',
            '0058513-24',
            '0058514-24',
            '0058515-24',
            '0058516-24',
            '0058517-24',
            '0058518-24',
            '0058519-24',
            '0058520-24',
            '0058521-24',
            '0058523-24',
            '0058524-24',
            '0058525-24',
            '0058527-24',
            '0058528-24',
            '0058529-24',
            '0058530-24',
            '0058531-24',
            '0058532-24',
            '0058533-24',
            '0058534-24',
            '0058535-24',
            '0058536-24',
            '0058537-24',
            '0058538-24',
            '0058539-24',
            '0058540-24',
            '0058541-24',
            '0058542-24',
            '0058543-24',
            '0058544-24',
            '0058545-24',
            '0058546-24',
            '0058547-24',
            '0058548-24',
            '0058549-24',
            '0058550-24',
            '0058551-24',
            '0058552-24',
            '0058553-24',
            '0058556-24',
            '0058557-24',
            '0058558-24',
            '0058559-24',
            '0058560-24',
            '0058561-24',
            '0058562-24',
            '0058563-24',
            '0058564-24',
            '0058565-24',
            '0058566-24',
            '0058568-24',
            '0058569-24',
            '0058571-24',
            '0058572-24',
            '0058573-24',
            '0058574-24',
            '0058575-24',
            '0058576-24',
            '0058577-24',
            '0058578-24',
            '0058579-24',
            '0058580-24',
            '0058581-24',
            '0058582-24',
            '0058583-24',
            '0058584-24',
            '0058585-24',
            '0058586-24',
            '0058587-24',
            '0058588-24',
            '0058589-24',
            '0058590-24',
            '0058591-24',
            '0058592-24',
            '0058593-24',
            '0058594-24',
            '0058597-24',
            '0058598-24',
            '0058600-24',
            '0058602-24',
            '0058603-24',
            '0058604-24',
            '0058605-24',
            '0058606-24',
            '0058607-24',
            '0058608-24',
            '0058609-24',
            '0058610-24',
            '0058611-24',
            '0058612-24',
            '0058613-24',
            '0058614-24',
            '0058615-24',
            '0058616-24',
            '0058617-24',
            '0058618-24',
            '0058619-24',
            '0058620-24',
            '0058621-24',
            '0058622-24',
            '0058623-24',
            '0058624-24',
            '0058625-24',
            '0058626-24',
            '0058627-24',
            '0058628-24',
            '0058629-24',
            '0058633-24',
            '0058634-24',
            '0058635-24',
            '0058636-24',
            '0058637-24',
            '0058638-24',
            '0058639-24',
            '0058640-24',
            '0058642-24',
            '0058643-24',
            '0058644-24',
            '0058646-24',
            '0058647-24',
            '0058648-24',
            '0058649-24',
            '0058650-24',
            '0058651-24',
            '0058652-24',
            '0058653-24',
            '0058654-24',
            '0058655-24',
            '0058657-24',
            '0058660-24',
            '0058662-24',
            '0058663-24',
            '0058664-24',
            '0058665-24',
            '0058666-24',
            '0058669-24',
            '0058671-24',
            '0058672-24',
            '0058673-24',
            '0058674-24',
            '0058676-24',
            '0058677-24',
            '0058678-24',
            '0058679-24',
            '0058682-24',
            '0058683-24',
            '0058684-24',
            '0058685-24',
            '0058686-24',
            '0058687-24',
            '0058688-24',
            '0058689-24',
            '0058690-24',
            '0058691-24',
            '0058692-24',
            '0058693-24',
            '0058694-24',
            '0058695-24',
            '0058696-24',
            '0058697-24',
            '0058698-24',
            '0058699-24',
            '0058700-24',
            '0058701-24',
            '0058702-24',
            '0058703-24',
            '0058704-24',
            '0058705-24',
            '0058706-24',
            '0058707-24',
            '0058708-24',
            '0058709-24',
            '0058710-24',
            '0058711-24',
            '0058712-24',
            '0058714-24',
            '0058716-24',
            '0058717-24',
            '0058718-24',
            '0058719-24',
            '0058720-24',
            '0058721-24',
            '0058722-24',
            '0058723-24',
            '0058725-24',
            '0058726-24',
            '0058727-24',
            '0058728-24',
            '0058729-24',
            '0058731-24',
            '0058732-24',
            '0058740-24',
            '0058744-24',
            '0058747-24',
            '0058748-24',
            '0058749-24',
            '0058750-24',
            '0058753-24',
            '0058755-24',
            '0058758-24',
            '0058759-24',
            '0058760-24',
            '0058761-24',
            '0058762-24',
            '0058763-24',
            '0058764-24',
            '0058765-24',
            '0058766-24',
            '0058767-24',
            '0058768-24',
            '0058769-24',
            '0058770-24',
            '0058771-24',
            '0058772-24',
            '0058773-24',
            '0058775-24',
            '0058776-24',
            '0058777-24',
            '0058778-24',
            '0058779-24',
            '0058780-24',
            '0058781-24',
            '0058782-24',
            '0058783-24',
            '0058784-24',
            '0058786-24',
            '0058787-24',
            '0058790-24',
            '0058791-24',
            '0058792-24',
            '0058793-24',
            '0058794-24',
            '0058795-24',
            '0058797-24',
            '0058798-24',
            '0058799-24',
            '0058801-24',
            '0058802-24',
            '0058803-24',
            '0058804-24',
            '0058805-24',
            '0058806-24',
            '0058807-24',
            '0058808-24',
            '0058809-24',
            '0058811-24',
            '0058812-24',
            '0058813-24',
            '0058814-24',
            '0058815-24',
            '0058817-24',
            '0058818-24',
            '0058819-24',
            '0058820-24',
            '0058821-24',
            '0058822-24',
            '0058824-24',
            '0058825-24',
            '0058826-24',
            '0058827-24',
            '0058828-24',
            '0058829-24',
            '0058831-24',
            '0058832-24',
            '0058833-24',
            '0058837-24',
            '0058839-24',
            '0058840-24',
            '0058841-24',
            '0058848-24',
            '0058849-24',
            '0058850-24',
            '0058851-24',
            '0058852-24',
            '0058853-24',
            '0058855-24',
            '0058861-24',
            '0058862-24',
            '0058864-24',
            '0058865-24',
            '0058868-24',
            '0058870-24',
            '0058871-24',
            '0058879-24',
            '0058883-24',
            '0058887-24',
            '0058889-24',
            '0058890-24',
            '0058892-24',
            '0058899-24',
            '0058905-24',
            '0058906-24',
            '0058909-24',
            '0058910-24',
            '0058912-24',
            '0058913-24',
            '0058914-24',
            '0058918-24',
            '0058919-24',
            '0058927-24',
            '0058928-24',
            '0058929-24',
            '0058931-24',
            '0058937-24',
            '0058944-24',
            '0058946-24',
            '0058947-24',
            '0058950-24',
            '0058951-24',
            '0058952-24',
            '0058958-24',
            '0058959-24',
            '0058961-24',
            '0058966-24',
            '0058967-24',
            '0058976-24',
            '0058982-24',
            '0058983-24',
            '0058984-24',
            '0058985-24',
            '0058994-24',
            '0059001-24',
            '0059002-24',
            '0059003-24',
            '0059005-24',
            '0059025-24',
            '0059033-24',
            '0059037-24',
            '0059038-24',
            '0059039-24',
            '0059040-24',
            '0059041-24',
            '0059058-24',
            '0059069-24',
            '0059071-24',
            '0059074-24',
            '0059094-24',
            '0059112-24',
            '0059211-24',
            '0059215-24',
            '0059217-24',
            '0059220-24',
            '0059553-24',
            '0059560-24',
            '0059569-24',
            '0059575-24',
            '0059584-24',
            '0059728-24',
            '0059765-24',
            '0059771-24',
            '0059776-24',
            '0059804-24',
            '0059808-24',
            '0059829-24',
            '0059959-24',
            '0060021-24',
            '0060053-24',
            '0060126-24',
            '0060128-24',
            '0060141-24',
            '0060152-24',
            '0060154-24',
            '0060162-24',
            '0060167-24',
            '0060168-24',
            '0060440-24',
            '0060463-24',
            '0060467-24',
            '0060515-24',
            '0060516-24',
            '0060554-24',
            '0060563-24',
            '0060567-24',
            '0060570-24',
            '0060575-24',
            '0060579-24',
            '0060614-24',
            '0060615-24',
            '0060631-24',
            '0060717-24',
            '0060718-24',
            '0060729-24',
            '0060739-24',
            '0060743-24',
            '0060744-24',
            '0060846-24',
            '0060848-24',
            '0060867-24',
            '0060871-24',
            '0060889-24',
            '0060893-24',
            '0060905-24',
            '0060955-24',
            '0061019-24',
            '0061027-24',
            '0061042-24',
            '0061084-24',
            '0061085-24',
            '0061087-24',
            '0063866-25',
            '0063867-25',
            '0064338-25',
            '0064484-25',
            '0065899-25',
            '0065932-25',
            '0065959-25',
            '0065961-25',
            '0066026-26',
            '0066030-26',
            '0066031-26',
            '0066035-26',
            '0066055-26',
            '0066056-26',
            '0066057-26',
            '0066059-26',
            '0066111-26',
            '0066120-26',
            '0066126-26',
            '0066128-26',
            '0066146-26',
            '0066154-26',
            '0066186-26',
            '0066187-26',
            '0066198-26',
            '0066201-26',
            '0066207-26',
            '0066208-26',
            '0066209-26',
            '0066211-26',
            '0066220-26',
            '0066221-26',
            '0066222-26',
            '0066223-26',
            '0066237-26',
            '0066243-26',
            '0066264-26',
            '0066273-26',
            '0066277-26',
            '0066291-26',
            '0066311-26',
            '0066315-26',
            '0066318-26',
            '0066330-26',
            '0066335-26',
            '0066336-26',
            '0066337-26',
            '0066338-26',
            '0066339-26',
            '0066340-26',
            '0066341-26',
            '0066342-26',
            '0066343-26',
            '0066344-26',
            '0066345-26',
            '0066348-26',
            '0066349-26',
            '0066357-26',
            '0066363-26',
            '0066364-26',
            '0066366-26',
            '0066368-26',
            '0066370-26',
            '0066372-26',
            '0066378-26',
            '0066379-26',
            '0066380-26',
            '0066381-26',
            '0066383-26',
            '0066384-26',
            '0066385-26',
            '0066386-26',
            '0066387-26',
            '0066388-26',
            '0066389-26',
            '0066392-26',
            '0066393-26',
            '0066394-26',
            '0066395-26',
            '0066398-26',
            '0066399-26',
            '0066400-26',
            '0066402-26',
            '0066409-26',
            '0066410-26',
            '0066411-26',
            '0066415-26',
            '0066417-26',
            '0066418-26',
            '0066419-26',
            '0066421-26',
            '0066422-26',
            '0066423-26',
            '0066424-26',
            '0066426-26',
            '0066427-26',
            '0066428-26',
            '0066432-26',
            '0066433-26',
            '0066434-26',
            '0066436-26',
            '0066437-26',
            '0066446-26',
            '0066456-26',
            '0066459-26',
            '0066460-26',
            '0066461-26',
            '0066462-26',
            '0066467-26',
            '0066468-26',
            '0066469-26',
            '0066470-26',
            '0066475-26',
            '0066477-26',
            '0066478-26',
            '0066480-26',
            '0066481-26',
            '0066482-26',
            '0066487-26',
            '0066489-26',
            '0066494-26',
            '0066495-26',
            '0066508-26',
            '0066519-26',
            '0066522-26',
            '0066525-26',
            '0066527-26',
            '0066532-26',
            '0066535-26',
            '0066540-26',
            '0066541-26',
            '0066542-26',
            '0066543-26',
            '0066544-26',
            '0066545-26',
            '0066546-26',
            '0066547-26',
            '0066548-26',
            '0066549-26',
            '0066552-26',
            '0066561-26'
        ];

        // Chunking per evitare query troppo grandi
        foreach (array_chunk($commesse, 100) as $chunk) {
            $placeholders = implode(',', array_fill(0, count($chunk), '?'));

            DB::update(
                "UPDATE ordine_fasi SET stato = '3'
                 WHERE stato = '2'
                 AND ordine_id IN (SELECT id FROM ordini WHERE commessa IN ($placeholders))",
                $chunk
            );

            DB::update(
                "UPDATE ordine_fasi SET stato = '2'
                 WHERE stato = '1'
                 AND ordine_id IN (SELECT id FROM ordini WHERE commessa IN ($placeholders))",
                $chunk
            );
        }
    }

    public function down(): void
    {
        $commesse = [
            '0058512-24',
            '0058513-24',
            '0058514-24',
            '0058515-24',
            '0058516-24',
            '0058517-24',
            '0058518-24',
            '0058519-24',
            '0058520-24',
            '0058521-24',
            '0058523-24',
            '0058524-24',
            '0058525-24',
            '0058527-24',
            '0058528-24',
            '0058529-24',
            '0058530-24',
            '0058531-24',
            '0058532-24',
            '0058533-24',
            '0058534-24',
            '0058535-24',
            '0058536-24',
            '0058537-24',
            '0058538-24',
            '0058539-24',
            '0058540-24',
            '0058541-24',
            '0058542-24',
            '0058543-24',
            '0058544-24',
            '0058545-24',
            '0058546-24',
            '0058547-24',
            '0058548-24',
            '0058549-24',
            '0058550-24',
            '0058551-24',
            '0058552-24',
            '0058553-24',
            '0058556-24',
            '0058557-24',
            '0058558-24',
            '0058559-24',
            '0058560-24',
            '0058561-24',
            '0058562-24',
            '0058563-24',
            '0058564-24',
            '0058565-24',
            '0058566-24',
            '0058568-24',
            '0058569-24',
            '0058571-24',
            '0058572-24',
            '0058573-24',
            '0058574-24',
            '0058575-24',
            '0058576-24',
            '0058577-24',
            '0058578-24',
            '0058579-24',
            '0058580-24',
            '0058581-24',
            '0058582-24',
            '0058583-24',
            '0058584-24',
            '0058585-24',
            '0058586-24',
            '0058587-24',
            '0058588-24',
            '0058589-24',
            '0058590-24',
            '0058591-24',
            '0058592-24',
            '0058593-24',
            '0058594-24',
            '0058597-24',
            '0058598-24',
            '0058600-24',
            '0058602-24',
            '0058603-24',
            '0058604-24',
            '0058605-24',
            '0058606-24',
            '0058607-24',
            '0058608-24',
            '0058609-24',
            '0058610-24',
            '0058611-24',
            '0058612-24',
            '0058613-24',
            '0058614-24',
            '0058615-24',
            '0058616-24',
            '0058617-24',
            '0058618-24',
            '0058619-24',
            '0058620-24',
            '0058621-24',
            '0058622-24',
            '0058623-24',
            '0058624-24',
            '0058625-24',
            '0058626-24',
            '0058627-24',
            '0058628-24',
            '0058629-24',
            '0058633-24',
            '0058634-24',
            '0058635-24',
            '0058636-24',
            '0058637-24',
            '0058638-24',
            '0058639-24',
            '0058640-24',
            '0058642-24',
            '0058643-24',
            '0058644-24',
            '0058646-24',
            '0058647-24',
            '0058648-24',
            '0058649-24',
            '0058650-24',
            '0058651-24',
            '0058652-24',
            '0058653-24',
            '0058654-24',
            '0058655-24',
            '0058657-24',
            '0058660-24',
            '0058662-24',
            '0058663-24',
            '0058664-24',
            '0058665-24',
            '0058666-24',
            '0058669-24',
            '0058671-24',
            '0058672-24',
            '0058673-24',
            '0058674-24',
            '0058676-24',
            '0058677-24',
            '0058678-24',
            '0058679-24',
            '0058682-24',
            '0058683-24',
            '0058684-24',
            '0058685-24',
            '0058686-24',
            '0058687-24',
            '0058688-24',
            '0058689-24',
            '0058690-24',
            '0058691-24',
            '0058692-24',
            '0058693-24',
            '0058694-24',
            '0058695-24',
            '0058696-24',
            '0058697-24',
            '0058698-24',
            '0058699-24',
            '0058700-24',
            '0058701-24',
            '0058702-24',
            '0058703-24',
            '0058704-24',
            '0058705-24',
            '0058706-24',
            '0058707-24',
            '0058708-24',
            '0058709-24',
            '0058710-24',
            '0058711-24',
            '0058712-24',
            '0058714-24',
            '0058716-24',
            '0058717-24',
            '0058718-24',
            '0058719-24',
            '0058720-24',
            '0058721-24',
            '0058722-24',
            '0058723-24',
            '0058725-24',
            '0058726-24',
            '0058727-24',
            '0058728-24',
            '0058729-24',
            '0058731-24',
            '0058732-24',
            '0058740-24',
            '0058744-24',
            '0058747-24',
            '0058748-24',
            '0058749-24',
            '0058750-24',
            '0058753-24',
            '0058755-24',
            '0058758-24',
            '0058759-24',
            '0058760-24',
            '0058761-24',
            '0058762-24',
            '0058763-24',
            '0058764-24',
            '0058765-24',
            '0058766-24',
            '0058767-24',
            '0058768-24',
            '0058769-24',
            '0058770-24',
            '0058771-24',
            '0058772-24',
            '0058773-24',
            '0058775-24',
            '0058776-24',
            '0058777-24',
            '0058778-24',
            '0058779-24',
            '0058780-24',
            '0058781-24',
            '0058782-24',
            '0058783-24',
            '0058784-24',
            '0058786-24',
            '0058787-24',
            '0058790-24',
            '0058791-24',
            '0058792-24',
            '0058793-24',
            '0058794-24',
            '0058795-24',
            '0058797-24',
            '0058798-24',
            '0058799-24',
            '0058801-24',
            '0058802-24',
            '0058803-24',
            '0058804-24',
            '0058805-24',
            '0058806-24',
            '0058807-24',
            '0058808-24',
            '0058809-24',
            '0058811-24',
            '0058812-24',
            '0058813-24',
            '0058814-24',
            '0058815-24',
            '0058817-24',
            '0058818-24',
            '0058819-24',
            '0058820-24',
            '0058821-24',
            '0058822-24',
            '0058824-24',
            '0058825-24',
            '0058826-24',
            '0058827-24',
            '0058828-24',
            '0058829-24',
            '0058831-24',
            '0058832-24',
            '0058833-24',
            '0058837-24',
            '0058839-24',
            '0058840-24',
            '0058841-24',
            '0058848-24',
            '0058849-24',
            '0058850-24',
            '0058851-24',
            '0058852-24',
            '0058853-24',
            '0058855-24',
            '0058861-24',
            '0058862-24',
            '0058864-24',
            '0058865-24',
            '0058868-24',
            '0058870-24',
            '0058871-24',
            '0058879-24',
            '0058883-24',
            '0058887-24',
            '0058889-24',
            '0058890-24',
            '0058892-24',
            '0058899-24',
            '0058905-24',
            '0058906-24',
            '0058909-24',
            '0058910-24',
            '0058912-24',
            '0058913-24',
            '0058914-24',
            '0058918-24',
            '0058919-24',
            '0058927-24',
            '0058928-24',
            '0058929-24',
            '0058931-24',
            '0058937-24',
            '0058944-24',
            '0058946-24',
            '0058947-24',
            '0058950-24',
            '0058951-24',
            '0058952-24',
            '0058958-24',
            '0058959-24',
            '0058961-24',
            '0058966-24',
            '0058967-24',
            '0058976-24',
            '0058982-24',
            '0058983-24',
            '0058984-24',
            '0058985-24',
            '0058994-24',
            '0059001-24',
            '0059002-24',
            '0059003-24',
            '0059005-24',
            '0059025-24',
            '0059033-24',
            '0059037-24',
            '0059038-24',
            '0059039-24',
            '0059040-24',
            '0059041-24',
            '0059058-24',
            '0059069-24',
            '0059071-24',
            '0059074-24',
            '0059094-24',
            '0059112-24',
            '0059211-24',
            '0059215-24',
            '0059217-24',
            '0059220-24',
            '0059553-24',
            '0059560-24',
            '0059569-24',
            '0059575-24',
            '0059584-24',
            '0059728-24',
            '0059765-24',
            '0059771-24',
            '0059776-24',
            '0059804-24',
            '0059808-24',
            '0059829-24',
            '0059959-24',
            '0060021-24',
            '0060053-24',
            '0060126-24',
            '0060128-24',
            '0060141-24',
            '0060152-24',
            '0060154-24',
            '0060162-24',
            '0060167-24',
            '0060168-24',
            '0060440-24',
            '0060463-24',
            '0060467-24',
            '0060515-24',
            '0060516-24',
            '0060554-24',
            '0060563-24',
            '0060567-24',
            '0060570-24',
            '0060575-24',
            '0060579-24',
            '0060614-24',
            '0060615-24',
            '0060631-24',
            '0060717-24',
            '0060718-24',
            '0060729-24',
            '0060739-24',
            '0060743-24',
            '0060744-24',
            '0060846-24',
            '0060848-24',
            '0060867-24',
            '0060871-24',
            '0060889-24',
            '0060893-24',
            '0060905-24',
            '0060955-24',
            '0061019-24',
            '0061027-24',
            '0061042-24',
            '0061084-24',
            '0061085-24',
            '0061087-24',
            '0063866-25',
            '0063867-25',
            '0064338-25',
            '0064484-25',
            '0065899-25',
            '0065932-25',
            '0065959-25',
            '0065961-25',
            '0066026-26',
            '0066030-26',
            '0066031-26',
            '0066035-26',
            '0066055-26',
            '0066056-26',
            '0066057-26',
            '0066059-26',
            '0066111-26',
            '0066120-26',
            '0066126-26',
            '0066128-26',
            '0066146-26',
            '0066154-26',
            '0066186-26',
            '0066187-26',
            '0066198-26',
            '0066201-26',
            '0066207-26',
            '0066208-26',
            '0066209-26',
            '0066211-26',
            '0066220-26',
            '0066221-26',
            '0066222-26',
            '0066223-26',
            '0066237-26',
            '0066243-26',
            '0066264-26',
            '0066273-26',
            '0066277-26',
            '0066291-26',
            '0066311-26',
            '0066315-26',
            '0066318-26',
            '0066330-26',
            '0066335-26',
            '0066336-26',
            '0066337-26',
            '0066338-26',
            '0066339-26',
            '0066340-26',
            '0066341-26',
            '0066342-26',
            '0066343-26',
            '0066344-26',
            '0066345-26',
            '0066348-26',
            '0066349-26',
            '0066357-26',
            '0066363-26',
            '0066364-26',
            '0066366-26',
            '0066368-26',
            '0066370-26',
            '0066372-26',
            '0066378-26',
            '0066379-26',
            '0066380-26',
            '0066381-26',
            '0066383-26',
            '0066384-26',
            '0066385-26',
            '0066386-26',
            '0066387-26',
            '0066388-26',
            '0066389-26',
            '0066392-26',
            '0066393-26',
            '0066394-26',
            '0066395-26',
            '0066398-26',
            '0066399-26',
            '0066400-26',
            '0066402-26',
            '0066409-26',
            '0066410-26',
            '0066411-26',
            '0066415-26',
            '0066417-26',
            '0066418-26',
            '0066419-26',
            '0066421-26',
            '0066422-26',
            '0066423-26',
            '0066424-26',
            '0066426-26',
            '0066427-26',
            '0066428-26',
            '0066432-26',
            '0066433-26',
            '0066434-26',
            '0066436-26',
            '0066437-26',
            '0066446-26',
            '0066456-26',
            '0066459-26',
            '0066460-26',
            '0066461-26',
            '0066462-26',
            '0066467-26',
            '0066468-26',
            '0066469-26',
            '0066470-26',
            '0066475-26',
            '0066477-26',
            '0066478-26',
            '0066480-26',
            '0066481-26',
            '0066482-26',
            '0066487-26',
            '0066489-26',
            '0066494-26',
            '0066495-26',
            '0066508-26',
            '0066519-26',
            '0066522-26',
            '0066525-26',
            '0066527-26',
            '0066532-26',
            '0066535-26',
            '0066540-26',
            '0066541-26',
            '0066542-26',
            '0066543-26',
            '0066544-26',
            '0066545-26',
            '0066546-26',
            '0066547-26',
            '0066548-26',
            '0066549-26',
            '0066552-26',
            '0066561-26'
        ];

        foreach (array_chunk($commesse, 100) as $chunk) {
            $placeholders = implode(',', array_fill(0, count($chunk), '?'));

            DB::update(
                "UPDATE ordine_fasi SET stato = '1'
                 WHERE stato = '2'
                 AND ordine_id IN (SELECT id FROM ordini WHERE commessa IN ($placeholders))",
                $chunk
            );

            DB::update(
                "UPDATE ordine_fasi SET stato = '2'
                 WHERE stato = '3'
                 AND ordine_id IN (SELECT id FROM ordini WHERE commessa IN ($placeholders))",
                $chunk
            );
        }
    }
};
